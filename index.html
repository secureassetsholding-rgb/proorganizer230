<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>proorganizer230 | Panel Principal</title>
  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#1e40af">
  <!-- Iconos premium (Font Awesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <!-- Estilos PROFESIONALES -->
  <link rel="stylesheet" href="styles.css">
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <!-- Botón toggle sidebar (solo móviles) -->
  <button class="sidebar-toggle" id="sidebarToggle">
    <i class="fa-solid fa-bars"></i>
  </button>

  <!-- Barra lateral de navegación -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <i class="fa-solid fa-calendar-check"></i>
      <span>proorganizer230</span>
    </div>

    <nav class="sidebar-nav">
      <a href="index.html" class="nav-link active">
        <i class="fa-solid fa-house"></i>
        <span>Inicio</span>
      </a>
      <a href="calendario.html" class="nav-link">
        <i class="fa-solid fa-calendar-days"></i>
        <span>Calendario</span>
      </a>
      <a href="tareas.html" class="nav-link">
        <i class="fa-solid fa-list-check"></i>
        <span>Tareas</span>
      </a>
      <a href="notas.html" class="nav-link">
        <i class="fa-solid fa-sticky-note"></i>
        <span>Notas</span>
      </a>
      <a href="gastos.html" class="nav-link">
        <i class="fa-solid fa-wallet"></i>
        <span>Gastos</span>
      </a>
      <a href="recordatorios.html" class="nav-link">
        <i class="fa-solid fa-bell"></i>
        <span>Recordatorios</span>
      </a>
      <a href="contactos.html" class="nav-link">
        <i class="fa-solid fa-address-book"></i>
        <span>Contactos</span>
      </a>
      <a href="ai-chat.html" class="nav-link">
        <i class="fa-solid fa-robot"></i>
        <span>Asistente IA</span>
      </a>
    </nav>
  </aside>

  <!-- Contenido principal del dashboard -->
  <main class="main-content">
    <header class="main-header">
      <h1 class="header-title">Panel de Organización</h1>
      <div class="user-profile">
        <div class="user-avatar" id="userAvatar">U</div>
        <span class="user-name" id="userName">Cargando...</span>
        <button class="logout-btn" onclick="logout()">
          <i class="fa-solid fa-right-from-bracket"></i>
        </button>
      </div>
    </header>

    <!-- Estadísticas rápidas (cargadas desde Firebase) -->
    <section class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon stat-teal">
          <i class="fa-solid fa-list-check"></i>
        </div>
        <div class="stat-info">
          <span class="stat-value" id="pendingTasks">0</span>
          <span class="stat-label">Tareas pendientes</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-green">
          <i class="fa-solid fa-calendar"></i>
        </div>
        <div class="stat-info">
          <span class="stat-value" id="todayEvents">0</span>
          <span class="stat-label">Eventos hoy</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-yellow">
          <i class="fa-solid fa-coins"></i>
        </div>
        <div class="stat-info">
          <span class="stat-value" id="monthExpenses">$0.00</span>
          <span class="stat-label">Gastos este mes</span>
        </div>
      </div>
    </section>

    <!-- Módulos principales -->
    <section class="modules-section">
      <h2 class="modules-title">Explora los módulos</h2>
      <div class="modules-grid">
        <a href="calendario.html" class="module-card">
          <div class="module-icon">
            <i class="fa-solid fa-calendar-days"></i>
          </div>
          <h3 class="module-name">Calendario</h3>
          <p class="module-desc">Eventos, fechas y recordatorios organizados</p>
        </a>

        <a href="tareas.html" class="module-card">
          <div class="module-icon">
            <i class="fa-solid fa-list-check"></i>
          </div>
          <h3 class="module-name">Tareas</h3>
          <p class="module-desc">Prioriza y completa tus pendientes</p>
        </a>

        <a href="notas.html" class="module-card">
          <div class="module-icon">
            <i class="fa-solid fa-sticky-note"></i>
          </div>
          <h3 class="module-name">Notas</h3>
          <p class="module-desc">Apuntes rápidos guardados en tu cuenta</p>
        </a>

        <a href="gastos.html" class="module-card">
          <div class="module-icon">
            <i class="fa-solid fa-wallet"></i>
          </div>
          <h3 class="module-name">Gastos</h3>
          <p class="module-desc">Controla tus finanzas mensuales</p>
        </a>

        <a href="recordatorios.html" class="module-card">
          <div class="module-icon">
            <i class="fa-solid fa-bell"></i>
          </div>
          <h3 class="module-name">Recordatorios</h3>
          <p class="module-desc">No olvides fechas importantes</p>
        </a>

        <a href="ai-chat.html" class="module-card">
          <div class="module-icon">
            <i class="fa-solid fa-robot"></i>
          </div>
          <h3 class="module-name">Asistente IA</h3>
          <p class="module-desc">Ayuda rápida con tu organización</p>
        </a>
      </div>
    </section>
  </main>

  <script>
    // Variables globales
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    let currentUser;

    // Toggle sidebar (móviles)
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });

    // Cerrar sidebar al hacer clic en contenido (móviles)
    document.querySelector('.main-content').addEventListener('click', () => {
      if (window.innerWidth < 768 && sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      }
    });

    // Verificar sesión de usuario
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = 'login.html';
      } else {
        currentUser = user;
        // Actualizar avatar y nombre
        const userName = user.displayName || user.email.split('@')[0];
        document.getElementById('userName').textContent = userName;
        document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();
        // Cargar estadísticas
        loadStats();
      }
    });

    // Cargar estadísticas desde Firebase
    function loadStats() {
      // Tareas pendientes
      db.collection('users').doc(currentUser.uid).collection('tasks')
        .where('completed', '==', false)
        .get()
        .then(snapshot => {
          document.getElementById('pendingTasks').textContent = snapshot.size;
        });

      // Eventos de hoy
      const today = new Date().toISOString().split('T')[0];
      db.collection('users').doc(currentUser.uid).collection('calendar_events')
        .where('date', '==', today)
        .get()
        .then(snapshot => {
          document.getElementById('todayEvents').textContent = snapshot.size;
        });

      // Gastos este mes
      const thisMonth = new Date().getMonth() + 1;
      const thisYear = new Date().getFullYear();
      db.collection('users').doc(currentUser.uid).collection('expenses')
        .get()
        .then(snapshot => {
          let total = 0;
          snapshot.forEach(doc => {
            const expenseDate = new Date(doc.data().createdAt.seconds * 1000);
            if (expenseDate.getMonth() + 1 === thisMonth && expenseDate.getFullYear() === thisYear) {
              total += doc.data().amount;
            }
          });
          document.getElementById('monthExpenses').textContent = `$${total.toFixed(2)}`;
        });
    }

    // Cerrar sesión
    function logout() {
      auth.signOut()
        .then(() => window.location.href = 'login.html')
        .catch(err => alert('Error al cerrar sesión: ' + err.message));
    }
  </script>
</body>
</html>
